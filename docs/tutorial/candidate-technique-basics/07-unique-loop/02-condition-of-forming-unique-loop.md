---
description: Condition of Forming Unique Loop
---

# 唯一环的形成条件

前面的内容我们简单说明了唯一环的四种基础类型。为了更好帮助你阅读后面规格推广的其他情况，我们这里给各位介绍一下唯一环的一些需要解答的、比较难思考的问题。

## 一些简单的思考 <a href="#consideration-on-condition" id="consideration-on-condition"></a>

前文我们给各位展示了四个类型。但是前三个例子都是在并排的三个宫里，而只有类型 4 的 6 个格子相隔会比较远一些。

这不免会让我们引起怀疑：这样的结构到底有什么形成条件？或者换句话，唯一环到底需要满足什么样的条件，环才能形成并引发矛盾，才能使用类型 1 到 4 的各种推理逻辑得到正确的结论。

首先，它得是偶数个单元格构成。这肯定是必需的。

其次，它需要让结构形成一个完整的闭环。所谓的闭环，指的是结构的所在行、列、宫不能有任何一个区域遗漏，即结构用到的格子分配到每一个出现的区域的时候，有一个或一些区域上只有一个单元格。这种摆明了就是放的时候填不同的数就会直接造成不同的影响。

第三，摆放的时候需要规避内部出现填数的矛盾。这看起来是一句废话。实际上唯一环要形成闭环，即使你用到的格子数是偶数个，它仍然会出现内部矛盾。

下面我们针对于这三点说明一下。

## 基础条件：闭环和行列宫数量均等 <a href="#basic-condition" id="basic-condition"></a>

先是一个基础条件。

**唯一环必须要使用偶数个单元格（假设有** $$2n$$ **个单元格），两两同行列宫相连形成闭环，且整体结构用到** $$n$$ **个行、**$$n$$ **个列和** $$n$$ **个宫。**

前面的部分比较好理解。重点是最后这部分必须 $$n$$ 个行列宫怎么来的。

你可以仔细对比前面介绍的题，就可以明显发现到，因为结构内部使用的是显性数对，所以一个区域下只能有两个单元格。

我们从唯一矩形的 4 个单元格入手思考。我们每次拓展两个新的单元格到结构里，不管形不形成闭环，但因为加的两个单元格本身会形成显性数对，所以它必须是单独的一个区域的两个格子，而不能是前面四个格子用到的行列宫。

一个唯一矩形用到 2 个行、2 个列和 2 个宫。当我们需要扩展结构时，我们需要拿掉唯一矩形的其中一个“角”，然后将其从外部拓展出两个单元格并嵌入结构里，最后再加一个格子构成闭环回路。

这里解释一下这个说法。所谓的“拿掉”，是为了去取消唯一矩形的闭环。拿掉哪一个无所谓，这里是讨论其理论构造，所以四个单元格拿掉哪一个其实都是一样的。如图所示：

<figure><img src="../../.gitbook/assets/image (11).png" alt="" width="375"><figcaption><p>示意图 1</p></figcaption></figure>

然后，拿掉其中一个位置。比如这个 `r2c7`。

<figure><img src="../../.gitbook/assets/image (12).png" alt="" width="375"><figcaption><p>示意图 2</p></figcaption></figure>

由于我们拿掉了其中的一个单元格，而它一定会有两个单元格和它成边，如图里画出来的这两条边的连接。

那么，我们此时要干嘛呢？构成更大的闭环。所以我们需要找两个单元格，一边连一个。对这个结构而言，因为 `r1c7` 和 `r2c3` 分别在 `c7` 和 `r2` 上都只有一个格子了，于是我们需要在这俩区域下追加新的单元格。

比如，我们把格子加在 `r7c7` 和 `r2c9` 上。

<figure><img src="../../.gitbook/assets/image (13).png" alt="" width="375"><figcaption><p>示意图 3</p></figcaption></figure>

如图所示。好了。我们发现，因为补充的两个单元格他们互相虽然没有啥关系，但是他们摆在结构里就立刻规避了裸露出来的 `r1c7` 和 `r2c3`。此时，新添加的这两个单元格便需要闭环回去。

这很好加了。我们只需要找到 `r7c9` 即可。这一个单元格一旦加上去，两边的单元格都能形成闭环。于是，加上 `r7c9`。我们一共加上三个单元格，去掉原有的一个单元格，最终 6 个单元格就能形成新的闭环：

<figure><img src="../../.gitbook/assets/image (14).png" alt="" width="375"><figcaption><p>示意图 4</p></figcaption></figure>

这样，唯一环就形成了。

而回顾一下刚才我们添加的逻辑。我们挖去了唯一矩形的其中一个角，然后加了三个格子。其中先加了两个格子在暴露出来的两个位置上，然后再加一个强行让新加入的两个单元格在结构里成为闭环。

所以总的步骤有三个：删除一个格子，多补充两个格子，最后再补充一个格子。删除一个格子会去掉一个行或列；而我们新加入的格子又会补回缺少行列的数量，最后形成闭环后，行列宫都会新增一个。注意，`r7c9` 这里和 `r7c7` 是刚好既在同一个行上，又在同一个宫里的。这里宫的计算别漏了。

所以，整个流程会新增一个行、一个列和一个宫。从原始唯一矩形入手我们就知道它本身使用的行列宫的数量就是一致的。那么每次新增加两个单元格，那么就会新增一个行、一个列和一个宫，数量仍然会保持一致。就这么一直延续下去，始终的行列宫数量都是一样的。

可以从补格子的逻辑上看出，这似乎只是一种补充方式。如果我们还在 `b123` 里选格子的话，那么补够 6 个单元格所导致的最终效果其实是一样的，不过这里就不赘述了。

这就是我想说的第一点。

## 特殊条件：无解规避 <a href="#special-condition" id="special-condition"></a>

在这个补充过程之中，我们难免会遇到一种构造。它只会在 8 个单元格或以上的时候存在，所以这个问题比较难以想到。

考虑一个 8 个单元格的闭环：

<figure><img src="../../.gitbook/assets/image (15).png" alt="" width="375"><figcaption><p>8 个单元格的闭环</p></figcaption></figure>

如图所示。这只是 8 个单元格形成闭环的其中一种特殊摆放形式。不是说 8 个单元格必须摆成这样。这里要拿这个特殊摆放形式举例。

这个摆放你认为它形成闭环的方式是什么呢？还能只用行和列吗？似乎不行。如果只用行列连线的话，看起来就会有两个闭环了：

<figure><img src="../../.gitbook/assets/image (16).png" alt="" width="375"><figcaption><p>8 个单元格的闭环的连线（错误）</p></figcaption></figure>

这肯定是不对的。因为两个闭环两两是相邻了，但它没有考虑到宫内连接的关系，因此被拆成了两个闭环。我们要用闭环，本质是为了让两两单元格相邻关联起来。图上这样并不会把所有 8 个单元格都关联起来——它只会一次关联 4 个。

所以正确的连法是什么样的呢？这里要用宫的连接方式了。当然，它也不是唯一的连法，这里画一种：

<figure><img src="../../.gitbook/assets/image (17).png" alt="" width="375"><figcaption><p>8 个单元格的闭环的连线（正确）</p></figcaption></figure>

这样就可以两两相邻的单元格配对连线成闭环了，而且也满足前面的基础条件限制（8 个单元格，用到 4 个行、4 个列和 4 个宫）。

不过，说这个是干嘛呢？说这个是告诉各位，8 个单元格开始，这种结构会有一个特殊现象。我们尝试把其中一个宫里的两个单元格给扭转一下。例如 `b1`，我们把 `r1c1` 和 `r3c3` 改成 `r1c3` 和 `r3c1`。这样扭转一下。

<figure><img src="../../.gitbook/assets/image (18).png" alt="" width="375"><figcaption><p>扭转后的 8 个单元格</p></figcaption></figure>

这样扭转不会改变用的行列宫的数量。因为它横纵并未发生变化；而扭转也不会超出宫的范畴，所以宫的数量也不变。不过，连线会稍微变一下。

<figure><img src="../../.gitbook/assets/image (19).png" alt="" width="375"><figcaption><p>扭转后的 8 个单元格的闭环连线</p></figcaption></figure>

看起来甚至都不用宫的连接了。这似乎也没毛病。

所以，它同时也满足我们刚才的闭环，偶数个单元格以及出现行列宫数量均等这些条件。那么它是唯一环了吗？

不是。它不是唯一环。实际上，你在假设内部填数后会发现，这个结构在内部会直接出现矛盾。这点稍微麻烦一些，需要你手动尝试填数并得出矛盾。

这里我们尽量不牵扯图论知识，简要描述一下我想表达的东西：**尝试在盘面的这些单元格里按照我们找出的这个闭环按照两种不同的颜色进行交替涂色。如果我们能发现，图中仍存在一对单元格（两个单元格）同在一个行列宫里，却具有相同涂色时，我们就可以认为这种画法是无解的**。

举个例子。前面的两种结构下，按照我们给定的闭环路径进行两种颜色的交替涂色，我们可以看到，这两个结构里，后者确实会存在问题：

<figure><img src="../../.gitbook/assets/image (66).png" alt=""><figcaption><p>两种结构的涂色结果</p></figcaption></figure>

如图所示。左图是之前的那个画法。我们发现，它怎么看都没有问题；但是右图却存在问题：虽然连线我们保证了交替涂色，但是在同一个宫里，却有相同的涂色。

如果你还没有明白涂色的本质含义的话，那我不妨说得更直白一些。涂色就意味着唯一环里的那两种数字。交替涂色的本质也就是交替地填入唯一环用到的两种不同的数。这么一转换，你应该就知道了为什么宫里存在同一种涂色是有问题的了：因为它意味着同一个宫里会填一样的数字。

这便是为什么，扭转了一个宫的情况，唯一环就不再成立的原因。

## 基于图论的说法 <a href="#concepts-in-graph-theory" id="concepts-in-graph-theory"></a>

可能有读者不明白，这么做为什么就知道唯一环直接不成立的根本原因。首先，**唯一环的这种闭环路径并不一定是唯一的**，例如左图里给的这个例子，这个闭环的画法只是它的其中一种连接方式。你完全可以找出另外一种（因为这 8 个单元格是对称的，所以你将路径中心对称地旋转一下就能得到另外一种连接方式）。所以，唯一环并没有唯一路径的。与此同时，我们也没有限制读者从哪一个单元格开始。

不过，这些都不重要。只要能找出一个这样的错误走法，那么这个环就必定不成立。不过，这个证明需要用到图论的知识，所以作为拓展内容介绍。有兴趣的可以了解一下。

从图论的角度来说，我们把唯一环这种存在至少一种闭环回路经过唯一环的每一个单元格的情况称为**哈密顿图**（Hamiltonian Graph），而在唯一环里，除了连线外，行列宫互相影响的我们可称为哈密顿图里的**弦**（Chord）。

我们如果使用两种涂色往哈密顿回路上交替往单元格里涂色，可以使得所有弦的两端都处于不同颜色的状态的话，我们可称这种哈密顿图为一个**二分图**（Biparatite Graph）。显然，唯一环是哈密顿图和二分图两个概念的交集。

而可以根据定义得出，但凡存在一条弦两端是相同的颜色，那么这个哈密顿图就不能称为二分图了。这就是为什么我们随便连，只要发现矛盾就一定不是唯一环的根本原因。

## 总结 <a href="#conclusion" id="conclusion"></a>

总之，唯一环要形成，需要满足如下的一些条件：

* 偶数个单元格；
* 两两相连成闭环（相连的格子必须同在一个行列宫里）；
  * 这一点有了之后就一定会是 $$n$$ 个行列宫，不用把它当成条件再说一遍
* 用两种颜色交替涂色的方式验证内部填数是否不矛盾。

下一讲内容我们来看更高规格的唯一环的情况。

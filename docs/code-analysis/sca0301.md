# SCA0301 ç¼–è¯‘å™¨åˆ†æ

## åŸºæœ¬ä¿¡æ¯

**æ ‡é¢˜**ï¼šMissing 'SelfAttribute'

**ç¿»è¯‘**ï¼šè¯¥æ³›å‹å‚æ•°ç¼ºå°‘ `SelfAttribute` ç‰¹æ€§æ ‡è®°

**ç±»å‹**ï¼šä½¿ç”¨ï¼ˆUsageï¼‰

**ä¸¥é‡çº§åˆ«**ï¼šç¼–è¯‘å™¨éšè—ä¿¡æ¯ï¼ˆğŸ’¡ï¼‰

## ä»‹ç»

é¡¹ç›®å¯¹ä¸€äº›ç”¨äºè¡¨ç¤ºå¯¹è±¡è‡ªèº«çš„æ³›å‹å‚æ•°æœ‰ç‰¹æ®Šæ”¯æŒã€‚è¿™äº›æ³›å‹å‚æ•°åŸºæœ¬å’Œ C++ è¯­è¨€çš„[å¥‡å¼‚é€’å½’æ¨¡æ¿æ¨¡å¼](https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern)ï¼ˆCRTPï¼‰æ˜¯ä¸€è‡´çš„æ„æ€ã€‚è¿™æ ·çš„æ³›å‹å‚æ•°åœ¨ C# é‡Œå°šæœªå¾—åˆ°è¯­æ³•æ”¯æŒï¼Œæ‰€ä»¥æœ¬é¡¹ç›®æœ‰å•ç‹¬çš„æ”¯æŒã€‚

å¦‚æœä¸€ä¸ªæ³›å‹å‚æ•°çš„æ³›å‹çº¦æŸé‡ŒåŒ…å«å®ƒè‡ªèº«ï¼Œè¿™æ ·çš„æ³›å‹å‚æ•°å°±éœ€è¦æ ‡è®° `SelfAttribute` æ¥æ ‡è®°ã€‚ä¸‹é¢çš„ä»£ç å°†ä¼šäº§ç”Ÿè¯¥ç¼–è¯‘å™¨ä¿¡æ¯ï¼š

```csharp
file interface ISelfType<T> where T : ISelfType<T> // SCA0301
{
}
```

ä½ åªéœ€è¦æ ‡è®°ç‰¹æ€§åˆ°æ³›å‹å‚æ•° `T` ä¸Šå³å¯ï¼š

```csharp
file interface ISelfType<[Self] T> where T : ISelfType<T>
{
}
```

## å¤‡æ³¨

æ»¡è¶³è¿™æ ·æ¡ä»¶çš„æ³›å‹å‚æ•°ä¸ä¸€å®šåªé™åˆ¶äºä»å®ƒè‡ªèº«è¿›è¡Œæ´¾ç”Ÿã€‚å³ä½¿å®ƒå¸¦æœ‰åˆ«çš„æ¡ä»¶é™åˆ¶ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ¯”å¦‚è¿™æ ·çš„ä»£ç ï¼š

```csharp
file interface ISelfType<[Self] T> where T : ISelfType<T>, IEquatable<T>, IEqualityOperators<T, T, bool>
{
}
```

æˆ–æ˜¯å¸¦æœ‰å¯ç©ºç±»å‹è®°å· `?`ï¼š

```csharp
file interface ISelfType<[Self] T> where T : ISelfType<T>?
{
}
```

å¸¦æœ‰å¯ç©ºç±»å‹è®°å· `?` çš„æ³›å‹çº¦æŸè¡¨ç¤ºçš„æ˜¯ï¼Œè¯¥æ³›å‹å‚æ•°é™¤äº†æ ‡è®°å…¶è‡ªèº«çš„æ´¾ç”Ÿä»¥å¤–ï¼Œä¹Ÿå…è®¸å®ƒä»¥å¯ç©ºå½¢å¼æ´¾ç”Ÿã€‚æ¯”å¦‚è¯´

```csharp
file readonly struct StructMap : IMap<StructMap> { } // OK
file sealed class ClassMap : IMap<ClassMap> { } // OK
file sealed class NullableClassMap : IMap<NullableClassMap?> { } // OK

file interface IMap<[Self] T> where T : IMap<T>? { }
```

ä½†å¦‚æœæ²¡æœ‰è¯¥å¯ç©ºç±»å‹æ ‡è®° `?` çš„è¯ï¼Œç¬¬ä¸‰ç§æƒ…å†µå°†ä¸å†åˆæ³•ï¼š

```csharp
file readonly struct StructMap : IMap<StructMap> { } // OK
file sealed class ClassMap : IMap<ClassMap> { } // OK
file sealed class NullableClassMap : IMap<NullableClassMap?> { } // Error

file interface IMap<[Self] T> where T : IMap<T> { }
```

